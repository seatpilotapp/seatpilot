# 2025-10-27 · PR-04 RSVP base

## Resumen
- Migración `supabase/sql/108_rsvp_base.sql` → tablas multi-tenant (events, guest_parties, guests, invitations, messages_outbox, rsvps) con RLS mediante `app.current_tenant_id()`, helper `app.guest_allows_channel` y vistas `invitations_stats` / `rsvps_stats`.
- Servicio `@seatpilot/rsvp-service` (Express + Postgres) con endpoints `send`, `remind`, `stats`, `portal`, `respond` y worker de outbox (`processOutboxBatch`).
- Portal público `/g/:event/:token` (token HMAC) y dashboard `/ops/rsvp` para métricas básicas.
- Runbook operativo actualizado (`docs/runbooks/rsvp_ops.md`) con checklist de opt-out y monitoreo.

## Evidencias
- `POST /api/rsvp/send` → encola invitaciones (idempotencia por `batchKey` + `idempotency_key`).
- `POST /api/rsvp/respond` → actualiza `rsvps` + `guests.status`.
- Worker marca `messages_outbox.status` → `sent|delivered`, sincroniza `invitations.sent_at`.
- Portal consume `verifyPortalToken()` y muestra estado actual.

## Notas
- Tokens HMAC (`RSVP_TOKEN_SECRET`, TTL 30 días, ver `services/rsvp/src/lib/tokens.ts`).
- Opt-out vía `guests.opt_out_channels`; helper SQL para validación.
- Documentación base consultada: `docs/chat/20251128.md`, `docs/books/*` (estrategia UX/copy), `docs/runbooks/observability_smoke.md` para formato.

## Próximos pasos
- Integrar proveedor real (Postmark/Twilio) en `simulateDelivery`.
- Añadir tests e2e Supabase (RLS negativo) y content tests (MIC).
- Ampliar portal con descarga QR y traducciones (locale).
